{"version":3,"file":"web-streams-adapter.min.mjs","sources":["../../node_modules/@mattiasbuelens/web-streams-adapter/dist/web-streams-adapter.mjs"],"sourcesContent":["/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n/* global Reflect, Promise */\n\nvar extendStatics = function(d, b) {\n    extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n    return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n    if (typeof b !== \"function\" && b !== null)\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nfunction assert(test) {\n    if (!test) {\n        throw new TypeError('Assertion failed');\n    }\n}\n\nfunction noop() {\n    return;\n}\nfunction typeIsObject(x) {\n    return (typeof x === 'object' && x !== null) || typeof x === 'function';\n}\n\nfunction isStreamConstructor(ctor) {\n    if (typeof ctor !== 'function') {\n        return false;\n    }\n    var startCalled = false;\n    try {\n        new ctor({\n            start: function () {\n                startCalled = true;\n            }\n        });\n    }\n    catch (e) {\n        // ignore\n    }\n    return startCalled;\n}\nfunction isReadableStream(readable) {\n    if (!typeIsObject(readable)) {\n        return false;\n    }\n    if (typeof readable.getReader !== 'function') {\n        return false;\n    }\n    return true;\n}\nfunction isReadableStreamConstructor(ctor) {\n    if (!isStreamConstructor(ctor)) {\n        return false;\n    }\n    if (!isReadableStream(new ctor())) {\n        return false;\n    }\n    return true;\n}\nfunction isWritableStream(writable) {\n    if (!typeIsObject(writable)) {\n        return false;\n    }\n    if (typeof writable.getWriter !== 'function') {\n        return false;\n    }\n    return true;\n}\nfunction isWritableStreamConstructor(ctor) {\n    if (!isStreamConstructor(ctor)) {\n        return false;\n    }\n    if (!isWritableStream(new ctor())) {\n        return false;\n    }\n    return true;\n}\nfunction isTransformStream(transform) {\n    if (!typeIsObject(transform)) {\n        return false;\n    }\n    if (!isReadableStream(transform.readable)) {\n        return false;\n    }\n    if (!isWritableStream(transform.writable)) {\n        return false;\n    }\n    return true;\n}\nfunction isTransformStreamConstructor(ctor) {\n    if (!isStreamConstructor(ctor)) {\n        return false;\n    }\n    if (!isTransformStream(new ctor())) {\n        return false;\n    }\n    return true;\n}\nfunction supportsByobReader(readable) {\n    try {\n        var reader = readable.getReader({ mode: 'byob' });\n        reader.releaseLock();\n        return true;\n    }\n    catch (_a) {\n        return false;\n    }\n}\nfunction supportsByteSource(ctor) {\n    try {\n        new ctor({ type: 'bytes' });\n        return true;\n    }\n    catch (_a) {\n        return false;\n    }\n}\n\nfunction createReadableStreamWrapper(ctor) {\n    assert(isReadableStreamConstructor(ctor));\n    var byteSourceSupported = supportsByteSource(ctor);\n    return function (readable, _a) {\n        var _b = _a === void 0 ? {} : _a, type = _b.type;\n        type = parseReadableType(type);\n        if (type === 'bytes' && !byteSourceSupported) {\n            type = undefined;\n        }\n        if (readable.constructor === ctor) {\n            if (type !== 'bytes' || supportsByobReader(readable)) {\n                return readable;\n            }\n        }\n        if (type === 'bytes') {\n            var source = createWrappingReadableSource(readable, { type: type });\n            return new ctor(source);\n        }\n        else {\n            var source = createWrappingReadableSource(readable);\n            return new ctor(source);\n        }\n    };\n}\nfunction createWrappingReadableSource(readable, _a) {\n    var _b = _a === void 0 ? {} : _a, type = _b.type;\n    assert(isReadableStream(readable));\n    assert(readable.locked === false);\n    type = parseReadableType(type);\n    var source;\n    if (type === 'bytes') {\n        source = new WrappingReadableByteStreamSource(readable);\n    }\n    else {\n        source = new WrappingReadableStreamDefaultSource(readable);\n    }\n    return source;\n}\nfunction parseReadableType(type) {\n    var typeString = String(type);\n    if (typeString === 'bytes') {\n        return typeString;\n    }\n    else if (type === undefined) {\n        return type;\n    }\n    else {\n        throw new RangeError('Invalid type is specified');\n    }\n}\nvar AbstractWrappingReadableStreamSource = /** @class */ (function () {\n    function AbstractWrappingReadableStreamSource(underlyingStream) {\n        this._underlyingReader = undefined;\n        this._readerMode = undefined;\n        this._readableStreamController = undefined;\n        this._pendingRead = undefined;\n        this._underlyingStream = underlyingStream;\n        // always keep a reader attached to detect close/error\n        this._attachDefaultReader();\n    }\n    AbstractWrappingReadableStreamSource.prototype.start = function (controller) {\n        this._readableStreamController = controller;\n    };\n    AbstractWrappingReadableStreamSource.prototype.cancel = function (reason) {\n        assert(this._underlyingReader !== undefined);\n        return this._underlyingReader.cancel(reason);\n    };\n    AbstractWrappingReadableStreamSource.prototype._attachDefaultReader = function () {\n        if (this._readerMode === \"default\" /* DEFAULT */) {\n            return;\n        }\n        this._detachReader();\n        var reader = this._underlyingStream.getReader();\n        this._readerMode = \"default\" /* DEFAULT */;\n        this._attachReader(reader);\n    };\n    AbstractWrappingReadableStreamSource.prototype._attachReader = function (reader) {\n        var _this = this;\n        assert(this._underlyingReader === undefined);\n        this._underlyingReader = reader;\n        var closed = this._underlyingReader.closed;\n        if (!closed) {\n            return;\n        }\n        closed\n            .then(function () { return _this._finishPendingRead(); })\n            .then(function () {\n            if (reader === _this._underlyingReader) {\n                _this._readableStreamController.close();\n            }\n        }, function (reason) {\n            if (reader === _this._underlyingReader) {\n                _this._readableStreamController.error(reason);\n            }\n        })\n            .catch(noop);\n    };\n    AbstractWrappingReadableStreamSource.prototype._detachReader = function () {\n        if (this._underlyingReader === undefined) {\n            return;\n        }\n        this._underlyingReader.releaseLock();\n        this._underlyingReader = undefined;\n        this._readerMode = undefined;\n    };\n    AbstractWrappingReadableStreamSource.prototype._pullWithDefaultReader = function () {\n        var _this = this;\n        this._attachDefaultReader();\n        // TODO Backpressure?\n        var read = this._underlyingReader.read()\n            .then(function (result) {\n            var controller = _this._readableStreamController;\n            if (result.done) {\n                _this._tryClose();\n            }\n            else {\n                controller.enqueue(result.value);\n            }\n        });\n        this._setPendingRead(read);\n        return read;\n    };\n    AbstractWrappingReadableStreamSource.prototype._tryClose = function () {\n        try {\n            this._readableStreamController.close();\n        }\n        catch (_a) {\n            // already errored or closed\n        }\n    };\n    AbstractWrappingReadableStreamSource.prototype._setPendingRead = function (readPromise) {\n        var _this = this;\n        var pendingRead;\n        var finishRead = function () {\n            if (_this._pendingRead === pendingRead) {\n                _this._pendingRead = undefined;\n            }\n        };\n        this._pendingRead = pendingRead = readPromise.then(finishRead, finishRead);\n    };\n    AbstractWrappingReadableStreamSource.prototype._finishPendingRead = function () {\n        var _this = this;\n        if (!this._pendingRead) {\n            return undefined;\n        }\n        var afterRead = function () { return _this._finishPendingRead(); };\n        return this._pendingRead.then(afterRead, afterRead);\n    };\n    return AbstractWrappingReadableStreamSource;\n}());\nvar WrappingReadableStreamDefaultSource = /** @class */ (function (_super) {\n    __extends(WrappingReadableStreamDefaultSource, _super);\n    function WrappingReadableStreamDefaultSource() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    WrappingReadableStreamDefaultSource.prototype.pull = function () {\n        return this._pullWithDefaultReader();\n    };\n    return WrappingReadableStreamDefaultSource;\n}(AbstractWrappingReadableStreamSource));\nfunction toUint8Array(view) {\n    return new Uint8Array(view.buffer, view.byteOffset, view.byteLength);\n}\nfunction copyArrayBufferView(from, to) {\n    var fromArray = toUint8Array(from);\n    var toArray = toUint8Array(to);\n    toArray.set(fromArray, 0);\n}\nvar WrappingReadableByteStreamSource = /** @class */ (function (_super) {\n    __extends(WrappingReadableByteStreamSource, _super);\n    function WrappingReadableByteStreamSource(underlyingStream) {\n        var _this = this;\n        var supportsByob = supportsByobReader(underlyingStream);\n        _this = _super.call(this, underlyingStream) || this;\n        _this._supportsByob = supportsByob;\n        return _this;\n    }\n    Object.defineProperty(WrappingReadableByteStreamSource.prototype, \"type\", {\n        get: function () {\n            return 'bytes';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    WrappingReadableByteStreamSource.prototype._attachByobReader = function () {\n        if (this._readerMode === \"byob\" /* BYOB */) {\n            return;\n        }\n        assert(this._supportsByob);\n        this._detachReader();\n        var reader = this._underlyingStream.getReader({ mode: 'byob' });\n        this._readerMode = \"byob\" /* BYOB */;\n        this._attachReader(reader);\n    };\n    WrappingReadableByteStreamSource.prototype.pull = function () {\n        if (this._supportsByob) {\n            var byobRequest = this._readableStreamController.byobRequest;\n            if (byobRequest) {\n                return this._pullWithByobRequest(byobRequest);\n            }\n        }\n        return this._pullWithDefaultReader();\n    };\n    WrappingReadableByteStreamSource.prototype._pullWithByobRequest = function (byobRequest) {\n        var _this = this;\n        this._attachByobReader();\n        // reader.read(view) detaches the input view, therefore we cannot pass byobRequest.view directly\n        // create a separate buffer to read into, then copy that to byobRequest.view\n        var buffer = new Uint8Array(byobRequest.view.byteLength);\n        // TODO Backpressure?\n        var read = this._underlyingReader.read(buffer)\n            .then(function (result) {\n            _this._readableStreamController;\n            if (result.done) {\n                _this._tryClose();\n                byobRequest.respond(0);\n            }\n            else {\n                copyArrayBufferView(result.value, byobRequest.view);\n                byobRequest.respond(result.value.byteLength);\n            }\n        });\n        this._setPendingRead(read);\n        return read;\n    };\n    return WrappingReadableByteStreamSource;\n}(AbstractWrappingReadableStreamSource));\n\nfunction createWritableStreamWrapper(ctor) {\n    assert(isWritableStreamConstructor(ctor));\n    return function (writable) {\n        if (writable.constructor === ctor) {\n            return writable;\n        }\n        var sink = createWrappingWritableSink(writable);\n        return new ctor(sink);\n    };\n}\nfunction createWrappingWritableSink(writable) {\n    assert(isWritableStream(writable));\n    assert(writable.locked === false);\n    var writer = writable.getWriter();\n    return new WrappingWritableStreamSink(writer);\n}\nvar WrappingWritableStreamSink = /** @class */ (function () {\n    function WrappingWritableStreamSink(underlyingWriter) {\n        var _this = this;\n        this._writableStreamController = undefined;\n        this._pendingWrite = undefined;\n        this._state = \"writable\" /* WRITABLE */;\n        this._storedError = undefined;\n        this._underlyingWriter = underlyingWriter;\n        this._errorPromise = new Promise(function (resolve, reject) {\n            _this._errorPromiseReject = reject;\n        });\n        this._errorPromise.catch(noop);\n    }\n    WrappingWritableStreamSink.prototype.start = function (controller) {\n        var _this = this;\n        this._writableStreamController = controller;\n        this._underlyingWriter.closed\n            .then(function () {\n            _this._state = \"closed\" /* CLOSED */;\n        })\n            .catch(function (reason) { return _this._finishErroring(reason); });\n    };\n    WrappingWritableStreamSink.prototype.write = function (chunk) {\n        var _this = this;\n        var writer = this._underlyingWriter;\n        // Detect past errors\n        if (writer.desiredSize === null) {\n            return writer.ready;\n        }\n        var writeRequest = writer.write(chunk);\n        // Detect future errors\n        writeRequest.catch(function (reason) { return _this._finishErroring(reason); });\n        writer.ready.catch(function (reason) { return _this._startErroring(reason); });\n        // Reject write when errored\n        var write = Promise.race([writeRequest, this._errorPromise]);\n        this._setPendingWrite(write);\n        return write;\n    };\n    WrappingWritableStreamSink.prototype.close = function () {\n        var _this = this;\n        if (this._pendingWrite === undefined) {\n            return this._underlyingWriter.close();\n        }\n        return this._finishPendingWrite().then(function () { return _this.close(); });\n    };\n    WrappingWritableStreamSink.prototype.abort = function (reason) {\n        if (this._state === \"errored\" /* ERRORED */) {\n            return undefined;\n        }\n        var writer = this._underlyingWriter;\n        return writer.abort(reason);\n    };\n    WrappingWritableStreamSink.prototype._setPendingWrite = function (writePromise) {\n        var _this = this;\n        var pendingWrite;\n        var finishWrite = function () {\n            if (_this._pendingWrite === pendingWrite) {\n                _this._pendingWrite = undefined;\n            }\n        };\n        this._pendingWrite = pendingWrite = writePromise.then(finishWrite, finishWrite);\n    };\n    WrappingWritableStreamSink.prototype._finishPendingWrite = function () {\n        var _this = this;\n        if (this._pendingWrite === undefined) {\n            return Promise.resolve();\n        }\n        var afterWrite = function () { return _this._finishPendingWrite(); };\n        return this._pendingWrite.then(afterWrite, afterWrite);\n    };\n    WrappingWritableStreamSink.prototype._startErroring = function (reason) {\n        var _this = this;\n        if (this._state === \"writable\" /* WRITABLE */) {\n            this._state = \"erroring\" /* ERRORING */;\n            this._storedError = reason;\n            var afterWrite = function () { return _this._finishErroring(reason); };\n            if (this._pendingWrite === undefined) {\n                afterWrite();\n            }\n            else {\n                this._finishPendingWrite().then(afterWrite, afterWrite);\n            }\n            this._writableStreamController.error(reason);\n        }\n    };\n    WrappingWritableStreamSink.prototype._finishErroring = function (reason) {\n        if (this._state === \"writable\" /* WRITABLE */) {\n            this._startErroring(reason);\n        }\n        if (this._state === \"erroring\" /* ERRORING */) {\n            this._state = \"errored\" /* ERRORED */;\n            this._errorPromiseReject(this._storedError);\n        }\n    };\n    return WrappingWritableStreamSink;\n}());\n\nfunction createTransformStreamWrapper(ctor) {\n    assert(isTransformStreamConstructor(ctor));\n    return function (transform) {\n        if (transform.constructor === ctor) {\n            return transform;\n        }\n        var transformer = createWrappingTransformer(transform);\n        return new ctor(transformer);\n    };\n}\nfunction createWrappingTransformer(transform) {\n    assert(isTransformStream(transform));\n    var readable = transform.readable, writable = transform.writable;\n    assert(readable.locked === false);\n    assert(writable.locked === false);\n    var reader = readable.getReader();\n    var writer;\n    try {\n        writer = writable.getWriter();\n    }\n    catch (e) {\n        reader.releaseLock(); // do not leak reader\n        throw e;\n    }\n    return new WrappingTransformStreamTransformer(reader, writer);\n}\nvar WrappingTransformStreamTransformer = /** @class */ (function () {\n    function WrappingTransformStreamTransformer(reader, writer) {\n        var _this = this;\n        this._transformStreamController = undefined;\n        this._onRead = function (result) {\n            if (result.done) {\n                return;\n            }\n            _this._transformStreamController.enqueue(result.value);\n            return _this._reader.read().then(_this._onRead);\n        };\n        this._onError = function (reason) {\n            _this._flushReject(reason);\n            _this._transformStreamController.error(reason);\n            _this._reader.cancel(reason).catch(noop);\n            _this._writer.abort(reason).catch(noop);\n        };\n        this._onTerminate = function () {\n            _this._flushResolve();\n            _this._transformStreamController.terminate();\n            var error = new TypeError('TransformStream terminated');\n            _this._writer.abort(error).catch(noop);\n        };\n        this._reader = reader;\n        this._writer = writer;\n        this._flushPromise = new Promise(function (resolve, reject) {\n            _this._flushResolve = resolve;\n            _this._flushReject = reject;\n        });\n    }\n    WrappingTransformStreamTransformer.prototype.start = function (controller) {\n        this._transformStreamController = controller;\n        this._reader.read()\n            .then(this._onRead)\n            .then(this._onTerminate, this._onError);\n        var readerClosed = this._reader.closed;\n        if (readerClosed) {\n            readerClosed\n                .then(this._onTerminate, this._onError);\n        }\n    };\n    WrappingTransformStreamTransformer.prototype.transform = function (chunk) {\n        return this._writer.write(chunk);\n    };\n    WrappingTransformStreamTransformer.prototype.flush = function () {\n        var _this = this;\n        return this._writer.close()\n            .then(function () { return _this._flushPromise; });\n    };\n    return WrappingTransformStreamTransformer;\n}());\n\nexport { createReadableStreamWrapper, createTransformStreamWrapper, createWrappingReadableSource, createWrappingTransformer, createWrappingWritableSink, createWritableStreamWrapper };\n//# sourceMappingURL=web-streams-adapter.mjs.map\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","__","this","constructor","create","assert","test","noop","typeIsObject","x","isStreamConstructor","ctor","startCalled","start","e","isReadableStream","readable","getReader","isWritableStream","writable","getWriter","isTransformStream","transform","supportsByobReader","mode","releaseLock","_a","createReadableStreamWrapper","isReadableStreamConstructor","byteSourceSupported","type","supportsByteSource","parseReadableType","undefined","source","createWrappingReadableSource","locked","WrappingReadableByteStreamSource","WrappingReadableStreamDefaultSource","typeString","String","RangeError","AbstractWrappingReadableStreamSource","underlyingStream","_underlyingReader","_readerMode","_readableStreamController","_pendingRead","_underlyingStream","_attachDefaultReader","controller","cancel","reason","_detachReader","reader","_attachReader","_this","closed","then","_finishPendingRead","close","error","catch","_pullWithDefaultReader","read","result","done","_tryClose","enqueue","value","_setPendingRead","readPromise","pendingRead","finishRead","afterRead","_super","apply","arguments","pull","toUint8Array","view","Uint8Array","buffer","byteOffset","byteLength","supportsByob","_supportsByob","defineProperty","get","enumerable","configurable","_attachByobReader","byobRequest","_pullWithByobRequest","from","to","fromArray","respond","set","createWritableStreamWrapper","isWritableStreamConstructor","sink","createWrappingWritableSink","writer","WrappingWritableStreamSink","underlyingWriter","_writableStreamController","_pendingWrite","_state","_storedError","_underlyingWriter","_errorPromise","Promise","resolve","reject","_errorPromiseReject","_finishErroring","write","chunk","desiredSize","ready","writeRequest","_startErroring","race","_setPendingWrite","_finishPendingWrite","abort","writePromise","pendingWrite","finishWrite","afterWrite","createTransformStreamWrapper","isTransformStreamConstructor","transformer","createWrappingTransformer","WrappingTransformStreamTransformer","_transformStreamController","_onRead","_reader","_onError","_flushReject","_writer","_onTerminate","_flushResolve","terminate","_flushPromise","readerClosed","flush"],"mappings":";;;;;;;;;;;;;;;gFAgBA,IAAIA,EAAgB,SAASC,EAAGC,GAI5B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOC,OAAOK,UAAUC,eAAeC,KAAKR,EAAGK,KAAIN,EAAEM,GAAKL,EAAEK,KACzFP,EAAcC,EAAGC,EAC5B,EAEA,SAASS,EAAUV,EAAGC,GAClB,GAAiB,mBAANA,GAA0B,OAANA,EAC3B,MAAM,IAAIU,UAAU,uBAAgCV,EAAK,iCAE7D,SAASW,IAAOC,KAAKC,YAAcd,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEO,UAAkB,OAANN,EAAaC,OAAOa,OAAOd,IAAMW,EAAGL,UAAYN,EAAEM,UAAW,IAAIK,EACnF,CAEA,SAASI,EAAOC,GACZ,IAAKA,EACD,MAAM,IAAIN,UAAU,mBAE5B,CAEA,SAASO,IAET,CACA,SAASC,EAAaC,GAClB,MAAqB,iBAANA,GAAwB,OAANA,GAA4B,mBAANA,CAC3D,CAEA,SAASC,EAAoBC,GACzB,GAAoB,mBAATA,EACP,OAAO,EAEX,IAAIC,GAAc,EAClB,IACI,IAAID,EAAK,CACLE,MAAO,WACHD,GAAc,KAI1B,MAAOE,IAGP,OAAOF,CACX,CACA,SAASG,EAAiBC,GACtB,QAAKR,EAAaQ,IAGgB,mBAAvBA,EAASC,SAIxB,CAUA,SAASC,EAAiBC,GACtB,QAAKX,EAAaW,IAGgB,mBAAvBA,EAASC,SAIxB,CAUA,SAASC,EAAkBC,GACvB,QAAKd,EAAac,OAGbP,EAAiBO,EAAUN,aAG3BE,EAAiBI,EAAUH,UAIpC,CAUA,SAASI,EAAmBP,GACxB,IAGI,OAFaA,EAASC,UAAU,CAAEO,KAAM,SACjCC,eACA,EAEX,MAAOC,GACH,OAAO,EAEf,CAWA,SAASC,EAA4BhB,GACjCN,EArEJ,SAAqCM,GACjC,QAAKD,EAAoBC,MAGpBI,EAAiB,IAAIJ,EAI9B,CA6DWiB,CAA4BjB,IACnC,IAAIkB,EAZR,SAA4BlB,GACxB,IAEI,OADA,IAAIA,EAAK,CAAEmB,KAAM,WACV,EAEX,MAAOJ,GACH,OAAO,EAEf,CAI8BK,CAAmBpB,GAC7C,OAAO,SAAUK,EAAUU,GACvB,IAAkCI,QAAlB,IAAPJ,EAAgB,GAAKA,GAAcI,KAK5C,GAHa,WADbA,EAAOE,EAAkBF,KACAD,IACrBC,OAAOG,GAEPjB,EAASb,cAAgBQ,IACZ,UAATmB,GAAoBP,EAAmBP,IACvC,OAAOA,EAGf,GAAa,UAATc,EAAkB,CAClB,IAAII,EAASC,EAA6BnB,EAAU,CAAEc,KAAMA,IAC5D,OAAO,IAAInB,EAAKuB,GAGZA,EAASC,EAA6BnB,GAC1C,OAAO,IAAIL,EAAKuB,GAG5B,CACA,SAASC,EAA6BnB,EAAUU,GAC5C,IAAkCI,QAAlB,IAAPJ,EAAgB,GAAKA,GAAcI,KAW5C,OAVAzB,EAAOU,EAAiBC,IACxBX,GAA2B,IAApBW,EAASoB,QAGH,WAFbN,EAAOE,EAAkBF,IAGZ,IAAIO,EAAiCrB,GAGrC,IAAIsB,EAAoCtB,EAGzD,CACA,SAASgB,EAAkBF,GACvB,IAAIS,EAAoBT,EAAPU,GACjB,GAAmB,UAAfD,EACA,OAAOA,EAEN,QAAaN,IAATH,EACL,OAAOA,EAGP,MAAM,IAAIW,WAAW,4BAE7B,CACA,IAAIC,EAAsD,WACtD,SAASA,EAAqCC,GAC1CzC,KAAK0C,uBAAoBX,EACzB/B,KAAK2C,iBAAcZ,EACnB/B,KAAK4C,+BAA4Bb,EACjC/B,KAAK6C,kBAAed,EACpB/B,KAAK8C,kBAAoBL,EAEzBzC,KAAK+C,uBA0FT,OAxFAP,EAAqC9C,UAAUiB,MAAQ,SAAUqC,GAC7DhD,KAAK4C,0BAA4BI,GAErCR,EAAqC9C,UAAUuD,OAAS,SAAUC,GAE9D,OADA/C,OAAkC4B,IAA3B/B,KAAK0C,mBACL1C,KAAK0C,kBAAkBO,OAAOC,IAEzCV,EAAqC9C,UAAUqD,qBAAuB,WAClE,GAAyB,YAArB/C,KAAK2C,YAAT,CAGA3C,KAAKmD,gBACL,IAAIC,EAASpD,KAAK8C,kBAAkB/B,YACpCf,KAAK2C,YAAc,UACnB3C,KAAKqD,cAAcD,KAEvBZ,EAAqC9C,UAAU2D,cAAgB,SAAUD,GACrE,IAAIE,EAAQtD,KACZG,OAAkC4B,IAA3B/B,KAAK0C,mBACZ1C,KAAK0C,kBAAoBU,EACzB,IAAIG,EAASvD,KAAK0C,kBAAkBa,OAC/BA,GAGLA,EACKC,MAAK,WAAc,OAAOF,EAAMG,wBAChCD,MAAK,WACFJ,IAAWE,EAAMZ,mBACjBY,EAAMV,0BAA0Bc,WAErC,SAAUR,GACLE,IAAWE,EAAMZ,mBACjBY,EAAMV,0BAA0Be,MAAMT,MAGzCU,MAAMvD,IAEfmC,EAAqC9C,UAAUyD,cAAgB,gBAC5BpB,IAA3B/B,KAAK0C,oBAGT1C,KAAK0C,kBAAkBnB,cACvBvB,KAAK0C,uBAAoBX,EACzB/B,KAAK2C,iBAAcZ,IAEvBS,EAAqC9C,UAAUmE,uBAAyB,WACpE,IAAIP,EAAQtD,KACZA,KAAK+C,uBAEL,IAAIe,EAAO9D,KAAK0C,kBAAkBoB,OAC7BN,MAAK,SAAUO,GAChB,IAAIf,EAAaM,EAAMV,0BACnBmB,EAAOC,KACPV,EAAMW,YAGNjB,EAAWkB,QAAQH,EAAOI,UAIlC,OADAnE,KAAKoE,gBAAgBN,GACdA,GAEXtB,EAAqC9C,UAAUuE,UAAY,WACvD,IACIjE,KAAK4C,0BAA0Bc,QAEnC,MAAOlC,MAIXgB,EAAqC9C,UAAU0E,gBAAkB,SAAUC,GACvE,IACIC,EADAhB,EAAQtD,KAERuE,EAAa,WACTjB,EAAMT,eAAiByB,IACvBhB,EAAMT,kBAAed,IAG7B/B,KAAK6C,aAAeyB,EAAcD,EAAYb,KAAKe,EAAYA,IAEnE/B,EAAqC9C,UAAU+D,mBAAqB,WAChE,IAAIH,EAAQtD,KACZ,GAAKA,KAAK6C,aAAV,CAGA,IAAI2B,EAAY,WAAc,OAAOlB,EAAMG,sBAC3C,OAAOzD,KAAK6C,aAAaW,KAAKgB,EAAWA,KAEtChC,CACX,IACIJ,EAAqD,SAAUqC,GAE/D,SAASrC,IACL,OAAkB,OAAXqC,GAAmBA,EAAOC,MAAM1E,KAAM2E,YAAc3E,KAK/D,OAPAH,EAAUuC,EAAqCqC,GAI/CrC,EAAoC1C,UAAUkF,KAAO,WACjD,OAAO5E,KAAK6D,0BAETzB,CACX,EAAEI,GACF,SAASqC,EAAaC,GAClB,OAAO,IAAIC,WAAWD,EAAKE,OAAQF,EAAKG,WAAYH,EAAKI,WAC7D,CAMA,IAAI/C,EAAkD,SAAUsC,GAE5D,SAAStC,EAAiCM,GACtC,IAAIa,EAAQtD,KACRmF,EAAe9D,EAAmBoB,GAGtC,OAFAa,EAAQmB,EAAO7E,KAAKI,KAAMyC,IAAqBzC,MACzCoF,cAAgBD,EACf7B,EAkDX,OAxDAzD,EAAUsC,EAAkCsC,GAQ5CpF,OAAOgG,eAAelD,EAAiCzC,UAAW,OAAQ,CACtE4F,IAAK,WACD,MAAO,SAEXC,YAAY,EACZC,cAAc,IAElBrD,EAAiCzC,UAAU+F,kBAAoB,WAC3D,GAAyB,SAArBzF,KAAK2C,YAAT,CAGAxC,EAAOH,KAAKoF,eACZpF,KAAKmD,gBACL,IAAIC,EAASpD,KAAK8C,kBAAkB/B,UAAU,CAAEO,KAAM,SACtDtB,KAAK2C,YAAc,OACnB3C,KAAKqD,cAAcD,KAEvBjB,EAAiCzC,UAAUkF,KAAO,WAC9C,GAAI5E,KAAKoF,cAAe,CACpB,IAAIM,EAAc1F,KAAK4C,0BAA0B8C,YACjD,GAAIA,EACA,OAAO1F,KAAK2F,qBAAqBD,GAGzC,OAAO1F,KAAK6D,0BAEhB1B,EAAiCzC,UAAUiG,qBAAuB,SAAUD,GACxE,IAAIpC,EAAQtD,KACZA,KAAKyF,oBAGL,IAAIT,EAAS,IAAID,WAAWW,EAAYZ,KAAKI,YAEzCpB,EAAO9D,KAAK0C,kBAAkBoB,KAAKkB,GAClCxB,MAAK,SAAUO,GAhD5B,IAA6B6B,EAAMC,EAC3BC,EAgDIxC,EAAMV,0BACFmB,EAAOC,MACPV,EAAMW,YACNyB,EAAYK,QAAQ,KApDPH,EAuDO7B,EAAOI,MAvDR0B,EAuDeH,EAAYZ,KAtDtDgB,EAAYjB,EAAae,GACff,EAAagB,GACnBG,IAAIF,EAAW,GAqDXJ,EAAYK,QAAQhC,EAAOI,MAAMe,gBAIzC,OADAlF,KAAKoE,gBAAgBN,GACdA,GAEJ3B,CACX,EAAEK,GAEF,SAASyD,EAA4BxF,GAEjC,OADAN,EAvRJ,SAAqCM,GACjC,QAAKD,EAAoBC,MAGpBO,EAAiB,IAAIP,EAI9B,CA+QWyF,CAA4BzF,IAC5B,SAAUQ,GACb,GAAIA,EAAShB,cAAgBQ,EACzB,OAAOQ,EAEX,IAAIkF,EAAOC,EAA2BnF,GACtC,OAAO,IAAIR,EAAK0F,GAExB,CACA,SAASC,EAA2BnF,GAChCd,EAAOa,EAAiBC,IACxBd,GAA2B,IAApBc,EAASiB,QAChB,IAAImE,EAASpF,EAASC,YACtB,OAAO,IAAIoF,EAA2BD,EAC1C,CACA,IAAIC,EAA4C,WAC5C,SAASA,EAA2BC,GAChC,IAAIjD,EAAQtD,KACZA,KAAKwG,+BAA4BzE,EACjC/B,KAAKyG,mBAAgB1E,EACrB/B,KAAK0G,OAAS,WACd1G,KAAK2G,kBAAe5E,EACpB/B,KAAK4G,kBAAoBL,EACzBvG,KAAK6G,cAAgB,IAAIC,SAAQ,SAAUC,EAASC,GAChD1D,EAAM2D,oBAAsBD,KAEhChH,KAAK6G,cAAcjD,MAAMvD,GAmF7B,OAjFAiG,EAA2B5G,UAAUiB,MAAQ,SAAUqC,GACnD,IAAIM,EAAQtD,KACZA,KAAKwG,0BAA4BxD,EACjChD,KAAK4G,kBAAkBrD,OAClBC,MAAK,WACNF,EAAMoD,OAAS,YAEd9C,OAAM,SAAUV,GAAU,OAAOI,EAAM4D,gBAAgBhE,OAEhEoD,EAA2B5G,UAAUyH,MAAQ,SAAUC,GACnD,IAAI9D,EAAQtD,KACRqG,EAASrG,KAAK4G,kBAElB,GAA2B,OAAvBP,EAAOgB,YACP,OAAOhB,EAAOiB,MAElB,IAAIC,EAAelB,EAAOc,MAAMC,GAEhCG,EAAa3D,OAAM,SAAUV,GAAU,OAAOI,EAAM4D,gBAAgBhE,MACpEmD,EAAOiB,MAAM1D,OAAM,SAAUV,GAAU,OAAOI,EAAMkE,eAAetE,MAEnE,IAAIiE,EAAQL,QAAQW,KAAK,CAACF,EAAcvH,KAAK6G,gBAE7C,OADA7G,KAAK0H,iBAAiBP,GACfA,GAEXb,EAA2B5G,UAAUgE,MAAQ,WACzC,IAAIJ,EAAQtD,KACZ,YAA2B+B,IAAvB/B,KAAKyG,cACEzG,KAAK4G,kBAAkBlD,QAE3B1D,KAAK2H,sBAAsBnE,MAAK,WAAc,OAAOF,EAAMI,YAEtE4C,EAA2B5G,UAAUkI,MAAQ,SAAU1E,GACnD,GAAoB,YAAhBlD,KAAK0G,OAIT,OADa1G,KAAK4G,kBACJgB,MAAM1E,IAExBoD,EAA2B5G,UAAUgI,iBAAmB,SAAUG,GAC9D,IACIC,EADAxE,EAAQtD,KAER+H,EAAc,WACVzE,EAAMmD,gBAAkBqB,IACxBxE,EAAMmD,mBAAgB1E,IAG9B/B,KAAKyG,cAAgBqB,EAAeD,EAAarE,KAAKuE,EAAaA,IAEvEzB,EAA2B5G,UAAUiI,oBAAsB,WACvD,IAAIrE,EAAQtD,KACZ,QAA2B+B,IAAvB/B,KAAKyG,cACL,OAAOK,QAAQC,UAEnB,IAAIiB,EAAa,WAAc,OAAO1E,EAAMqE,uBAC5C,OAAO3H,KAAKyG,cAAcjD,KAAKwE,EAAYA,IAE/C1B,EAA2B5G,UAAU8H,eAAiB,SAAUtE,GAC5D,IAAII,EAAQtD,KACZ,GAAoB,aAAhBA,KAAK0G,OAAsC,CAC3C1G,KAAK0G,OAAS,WACd1G,KAAK2G,aAAezD,EACpB,IAAI8E,EAAa,WAAc,OAAO1E,EAAM4D,gBAAgBhE,SACjCnB,IAAvB/B,KAAKyG,cACLuB,IAGAhI,KAAK2H,sBAAsBnE,KAAKwE,EAAYA,GAEhDhI,KAAKwG,0BAA0B7C,MAAMT,KAG7CoD,EAA2B5G,UAAUwH,gBAAkB,SAAUhE,GACzC,aAAhBlD,KAAK0G,QACL1G,KAAKwH,eAAetE,GAEJ,aAAhBlD,KAAK0G,SACL1G,KAAK0G,OAAS,UACd1G,KAAKiH,oBAAoBjH,KAAK2G,gBAG/BL,CACX,IAEA,SAAS2B,EAA6BxH,GAElC,OADAN,EAnXJ,SAAsCM,GAClC,QAAKD,EAAoBC,MAGpBU,EAAkB,IAAIV,EAI/B,CA2WWyH,CAA6BzH,IAC7B,SAAUW,GACb,GAAIA,EAAUnB,cAAgBQ,EAC1B,OAAOW,EAEX,IAAI+G,EAAcC,EAA0BhH,GAC5C,OAAO,IAAIX,EAAK0H,GAExB,CACA,SAASC,EAA0BhH,GAC/BjB,EAAOgB,EAAkBC,IACzB,IAAIN,EAAWM,EAAUN,SAAUG,EAAWG,EAAUH,SACxDd,GAA2B,IAApBW,EAASoB,QAChB/B,GAA2B,IAApBc,EAASiB,QAChB,IACImE,EADAjD,EAAStC,EAASC,YAEtB,IACIsF,EAASpF,EAASC,YAEtB,MAAON,GAEH,MADAwC,EAAO7B,cACDX,EAEV,OAAO,IAAIyH,EAAmCjF,EAAQiD,EAC1D,CACA,IAAIgC,EAAoD,WACpD,SAASA,EAAmCjF,EAAQiD,GAChD,IAAI/C,EAAQtD,KACZA,KAAKsI,gCAA6BvG,EAClC/B,KAAKuI,QAAU,SAAUxE,GACrB,IAAIA,EAAOC,KAIX,OADAV,EAAMgF,2BAA2BpE,QAAQH,EAAOI,OACzCb,EAAMkF,QAAQ1E,OAAON,KAAKF,EAAMiF,UAE3CvI,KAAKyI,SAAW,SAAUvF,GACtBI,EAAMoF,aAAaxF,GACnBI,EAAMgF,2BAA2B3E,MAAMT,GACvCI,EAAMkF,QAAQvF,OAAOC,GAAQU,MAAMvD,GACnCiD,EAAMqF,QAAQf,MAAM1E,GAAQU,MAAMvD,IAEtCL,KAAK4I,aAAe,WAChBtF,EAAMuF,gBACNvF,EAAMgF,2BAA2BQ,YACjC,IAAInF,EAAQ,IAAI7D,UAAU,8BAC1BwD,EAAMqF,QAAQf,MAAMjE,GAAOC,MAAMvD,IAErCL,KAAKwI,QAAUpF,EACfpD,KAAK2I,QAAUtC,EACfrG,KAAK+I,cAAgB,IAAIjC,SAAQ,SAAUC,EAASC,GAChD1D,EAAMuF,cAAgB9B,EACtBzD,EAAMoF,aAAe1B,KAsB7B,OAnBAqB,EAAmC3I,UAAUiB,MAAQ,SAAUqC,GAC3DhD,KAAKsI,2BAA6BtF,EAClChD,KAAKwI,QAAQ1E,OACRN,KAAKxD,KAAKuI,SACV/E,KAAKxD,KAAK4I,aAAc5I,KAAKyI,UAClC,IAAIO,EAAehJ,KAAKwI,QAAQjF,OAC5ByF,GACAA,EACKxF,KAAKxD,KAAK4I,aAAc5I,KAAKyI,WAG1CJ,EAAmC3I,UAAU0B,UAAY,SAAUgG,GAC/D,OAAOpH,KAAK2I,QAAQxB,MAAMC,IAE9BiB,EAAmC3I,UAAUuJ,MAAQ,WACjD,IAAI3F,EAAQtD,KACZ,OAAOA,KAAK2I,QAAQjF,QACfF,MAAK,WAAc,OAAOF,EAAMyF,kBAElCV,CACX"}